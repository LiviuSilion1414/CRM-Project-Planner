@page "/account-manager/delete/user/{Id:int}"

@using PlannerCRM.Shared.DTOs.EmployeeDto.Views
@using PlannerCRM.Shared.Models

@inject NavigationManager navManager
@inject HttpClient httpClient

@attribute [Authorize(Roles = nameof(Roles.ACCOUNT_MANAGER))]

<PageTitle>Elimina utente</PageTitle>

<div>
    <span>Vuoi eliminare:
        <br>  
        <strong>Nome:</strong> @_model.FullName 
        <br>
        <strong>Ruolo:</strong> @_model.Role ?
        <br>
    </span>
    <button type="button" class="btn btn-danger" @onclick="OnClickDeleteUser">Conferma</button>
    <button type="button" class="btn btn-link" @onclick="OnClickCancel">Annulla</button>
</div>

@code {
    [Parameter] public int Id { get; set; }
    private EmployeeDeleteDto _model = new();

    protected override async Task OnInitializedAsync() {
        _model = await httpClient.GetFromJsonAsync<EmployeeDeleteDto>($"http://localhost:5032/employee/get/for/delete/{Id}");
    }

    private void RedirectToPage() {
        navManager.NavigateTo("/account-manager");
    }

    private void OnClickCancel() {
        RedirectToPage();
    }

    private async Task OnClickDeleteUser() {
        await httpClient.DeleteAsync($"http://localhost:5032/employee/delete/{Id}");
        await httpClient.DeleteAsync($"http://localhost:5032/applicationuser/delete/user/{_model.Email}");
        
        RedirectToPage();
    }
}

