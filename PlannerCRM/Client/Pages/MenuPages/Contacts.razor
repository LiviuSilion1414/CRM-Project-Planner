@page "/clients"
@inject DialogService ds
@inject FetchService<FirmClientDto> fs

<h3>Clients</h3>
<PageTitle>Clients</PageTitle>

<RadzenDataGrid Data="@_clients"
                TItem="@FirmClientDto"
                AllowSorting="true"
                AllowPaging="true"
                AllowFiltering="true"
                SelectionMode="DataGridSelectionMode.Single"
                RowSelect="OnSelect">
    <Columns>
        <RadzenDataGridColumn TItem="@FirmClientDto" Property="Name" Title="Name" />
        <RadzenDataGridColumn TItem="@FirmClientDto" Property="VatNumber" Title="Vat Number" />
    </Columns>
</RadzenDataGrid>

@code {
    private List<FirmClientDto> _clients = new();
    private PaginationHelper _pg = new() { Limit = 100, Offset = 0 };

    private bool _isSelected = false;
    private FirmClientDto _selectedClient = null;

    protected override async Task OnInitializedAsync()
    {
        _clients = await fs.GetAll(
            ControllersNames.FIRM_CLIENT,
            CrudApiManager.GET_WITH_PAGINATION,
            _pg.Limit,
            _pg.Offset
        );
    }


    private async Task OnSelect(FirmClientDto client)
    {
        _selectedClient = client;

        await ds.OpenAsync<ClientDialog>("Client info",
               new Dictionary<string, object>() { { nameof(ClientDialog.SelectedClient), _selectedClient } });
    }
}