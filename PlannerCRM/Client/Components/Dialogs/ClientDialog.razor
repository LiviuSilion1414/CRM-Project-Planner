@inject DialogService ds
@inject FetchService<FirmClientDto> fs
@inject FetchService<WorkOrderDto> wfs

<RadzenStack AlignItems="AlignItems.Start" Orientation="Orientation.Vertical">
    <RadzenStack>
        <RadzenRow>
            <RadzenFieldset Text="Client Info">
                <RadzenColumn>
                    <RadzenText TextStyle="TextStyle.H6">Name: @SelectedClient.Name</RadzenText>
                    <RadzenText TextStyle="TextStyle.H6">Vat Number: @SelectedClient.VatNumber</RadzenText>
                </RadzenColumn>
            </RadzenFieldset>
        </RadzenRow>
        <RadzenRow>
            <RadzenFieldset Text="Related Workorders">
                <RadzenColumn>
                    <RadzenDataGrid TItem="@WorkOrderDto"
                    LoadData="@LoadRelatedWorkOrders"
                    AllowVirtualization="true"
                    Data="@SelectedClient.WorkOrders"
                    AllowPaging="true"
                    AllowFiltering="true">
                        <RadzenDataGridColumn Property="@nameof(WorkOrderDto.Name)" />
                        <RadzenDataGridColumn Property="@nameof(WorkOrderDto.StartDate)" />
                        <RadzenDataGridColumn Property="@nameof(WorkOrderDto.EndDate)" />
                    </RadzenDataGrid>
                </RadzenColumn>
            </RadzenFieldset>
        </RadzenRow>
    </RadzenStack>
    <RadzenStack AlignItems="AlignItems.End">
        <RadzenRow>
            <RadzenColumn>
                <RadzenButton ButtonType="ButtonType.Button" ButtonStyle="ButtonStyle.Danger" Variant="Variant.Outlined" Text="Delete" Click="OnDelete"></RadzenButton>
                <RadzenButton ButtonType="ButtonType.Button" ButtonStyle="ButtonStyle.Primary" Variant="Variant.Outlined" Text="Edit" Click="OnEdit"></RadzenButton>
            </RadzenColumn>
        </RadzenRow>
    </RadzenStack>
</RadzenStack>

@code
{
    [Parameter] public FirmClientDto SelectedClient { get; set; }

    private async Task LoadRelatedWorkOrders(LoadDataArgs args)
    {
        SelectedClient.WorkOrders = await wfs.GetAll(
            ControllersNames.FIRM_CLIENT,
            ClientApiManager.FindAssociatedWorkOrdersByClientId(SelectedClient.Id)
        );
    }

    private async Task OnEdit()
    {
        await ds.OpenAsync<ClientEditForm>("Edit client",
            new Dictionary<string, object>()
                {
                { nameof(ClientEditForm.Model), SelectedClient }
                }
        );
    }

    private async Task OnDelete()
    {
        await ds.OpenAsync<ClientAlertDeleteDialog>("Delete item",
            new Dictionary<string, object>()
                {
                { nameof(ClientAlertDeleteDialog.Model), SelectedClient }
                }
        );
    }
}
